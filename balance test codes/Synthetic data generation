import numpy as np
import pandas as pd
from scipy.stats import truncnorm

# Helper: truncated normal sampling
def truncated_normal(mean, sd, n, low=0.0, high=45.0):
    a, b = (low - mean) / sd, (high - mean) / sd
    return truncnorm.rvs(a, b, loc=mean, scale=sd, size=n)

# Original means (lower SDs for clearer trends)
data = [
    (18, 39, "F", 44, 8.5, 3.5),
    (18, 39, "M", 54, 10.2, 3.8),
    (40, 49, "F", 47, 7.4, 3.0),
    (40, 49, "M", 51, 7.3, 3.2),
    (50, 59, "F", 50, 5.0, 2.5),
    (50, 59, "M", 48, 4.5, 2.2),
    (60, 69, "F", 50, 2.5, 1.0),
    (60, 69, "M", 51, 3.1, 1.1),
    (70, 79, "F", 45, 2.2, 0.8),
    (70, 79, "M", 50, 1.9, 0.7),
    (80, 99, "F", 22, 1.4, 0.5),
    (80, 99, "M", 37, 1.3, 0.45)
]

# Extra synthetic high-balance-duration data (to cover longer durations)
extra_data = [
    (18, 29, "F", 30, 18, 3),   # n=30, mean=18s, sd=3
    (18, 29, "M", 30, 18, 3),
]

rows = []

# Generate main dataset
for age_min, age_max, gender, n, mean, sd in data:
    ages = np.random.randint(age_min, age_max + 1, size=n)
    times = truncated_normal(mean, sd, n)
    age_range = age_max - age_min
    if age_range > 0:
        adjustment = ((ages - age_min) / age_range) * (-0.25 * sd)
        times = times + adjustment
    times = np.clip(times, 0.0, 45.0)
    rows += list(zip([gender]*n, times, ages))

# Generate extra high-duration data
for age_min, age_max, gender, n, mean, sd in extra_data:
    ages = np.random.randint(age_min, age_max + 1, size=n)
    times = truncated_normal(mean, sd, n, low=mean-2, high=45.0)  # focus on higher values
    rows += list(zip([gender]*n, times, ages))

# Create DataFrame
df = pd.DataFrame(rows, columns=["gender", "balance_duration_s", "age"])
df.to_csv("unipedal_eyes_closed_lowerSD_extraHigh.csv", index=False)

# Quick summary
df['age_band'] = pd.cut(df['age'], bins=[17,39,49,59,69,79,200],
                        labels=["18-39","40-49","50-59","60-69","70-79","80+"])
print("Overall stats:")
print(df['balance_duration_s'].describe().round(2))
print("\nMeans & SD by age-band:")
print(df.groupby('age_band')['balance_duration_s'].agg(['count','mean','std']).round(2))

import os
print("Saved file path:", os.path.abspath("unipedal_eyes_closed_lowerSD_extraHigh.csv"))
